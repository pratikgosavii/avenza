{% extends "partials/adminBase.html" %}
{% load static %}

{% block title %}Create Package{% endblock title %}

{% block extra_css %}
    <!-- plugin css -->
    <link href="{% static 'libs/admin-resources/jquery.vectormap/jquery-jvectormap-1.2.2.css' %}" rel="stylesheet" type="text/css"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <style>
        body {
            background-color: #f0d28c;
            padding-bottom: 20px;
        }

        .form-container {
            background-color: #ffffff;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .form-heading {
            text-align: left;
            margin-bottom: 20px;
            font-weight: bold;
            font-size: 2rem;
            color: #291a4a;
        }

        .description-box {
            height: 150px;
            resize: none;
        }

        .image-preview {
            max-height: 100px;
            margin-top: 10px;
        }

        .btn-primary {
            background-color: #291a4a;
            border-color: #291a4a;
        }

        .custom-button {
            width: 150px;
        }
    </style>
{% endblock extra_css %}

{% block content %}
    {% include "createPackageContent.html" with title='Create Package' pageview='Create Package' %}
{% endblock content %}

{% block extra_js %}
    <!-- apexcharts -->
    <script src="{% static 'libs/apexcharts/dist/apexcharts.min.js' %}"></script>
    <script>
        // Image preview logic
        document.getElementById("bannerImage").addEventListener("change", function () {
            const file = this.files[0];
            const preview = document.getElementById("preview");

            if (file) {
                const reader = new FileReader();
                reader.onload = function (event) {
                    preview.src = event.target.result;
                    preview.hidden = false;
                };
                reader.readAsDataURL(file);
            } else {
                preview.src = "";
                preview.hidden = true;
            }
        });
    </script>

    <script>
        // Auto-hide toast after 5 seconds
        setTimeout(() => {
            const toastElement = document.getElementById("toast");
            if (toastElement) {
                toastElement.classList.remove("show"); // Hide toast
                setTimeout(() => {
                    toastElement.remove(); // Remove from DOM
                }, 500); // Wait for fade-out animation
            }
        }, 5000);
    </script>

    <script>
        document.getElementById("location").addEventListener("change", function () {
            var locationId = this.value;

            if (locationId) {
                // Make an AJAX request to fetch categories based on selected location
                fetch(`/api/categories/get/location/${locationId}/`)
                    .then(response => response.json())
                    .then(data => {
                        var categorySelect = document.getElementById("Categories");

                        // Clear existing categories
                        categorySelect.innerHTML = '<option value="" disabled selected>Select Categories</option>';

                        // Add the new filtered categories
                        data.forEach(function (category) {
                            var option = document.createElement("option");
                            option.value = category.id;
                            option.textContent = category.title;
                            categorySelect.appendChild(option);
                        });
                    })
                    .catch(error => console.error("Error fetching categories:", error));
            } else {
                // If no location selected, clear the category dropdown
                document.getElementById("Categories").innerHTML = '<option value="" disabled selected>Select Categories</option>';
            }
        });
    </script>

    <script>
        // JavaScript to dynamically append price fields based on selected categories
        document.addEventListener("DOMContentLoaded", function() {
            const categoriesSelect = document.getElementById('Categories');
            const priceFieldsContainer = document.getElementById('priceFieldsContainer');

            categoriesSelect.addEventListener('change', function() {
                // Clear previous price fields
                priceFieldsContainer.innerHTML = '';

                // Get the number of selected categories
                const selectedCategories = Array.from(categoriesSelect.selectedOptions);

                selectedCategories.forEach((category, index) => {
                    // Create a new input for each selected category
                    const priceDiv = document.createElement('div');
                    priceDiv.classList.add('mb-4');
                    priceDiv.innerHTML = `
                        <label for="price_${index}" class="form-label">Price for ${category.textContent}:</label>
                        <input
                            type="number"
                            class="form-control"
                            id="price_${index}"
                            name="prices[${category.value}]"
                            placeholder="Enter price for ${category.textContent}"
                            required
                        />
                    `;
                    priceFieldsContainer.appendChild(priceDiv);
                });
            });
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{% static 'libs/admin-resources/jquery.vectormap/maps/jquery-jvectormap-world-mill-en.js' %}"></script>
    <script src="{% static 'js/pages/allchart.js' %}"></script>
    <!-- dashboard init -->
    <script src="{% static 'js/pages/dashboard.init.js' %}"></script>
{% endblock extra_js %}
